# tup_dart_2024_Beta

## 介绍
本项目是TUP2024飞镖测试架的代码

## 操作逻辑

### 整体操作逻辑

- 右拨杆下：无力模式
    - 读取摩擦轮转速
    - 左拨杆中：调整摩擦轮转速
- 右拨杆中：调整模式
    - 左拨杆下中：调整滑块位置
    - 左拨杆上：校准滑块零点
- 右拨杆上：发射模式
    - 左拨杆下：准备发射
    - 左拨杆中上：开始发射

### 详细逻辑

- 调整摩擦轮转速
  - 右摇杆保持↗/↖/↙：写转速千位/百位/十位；右摇杆保持↘：读转速
  - 写转速时，左摇杆右拨一次所有摩擦轮转速+1000/100/10，左拨一次所有摩擦轮转速-1000/100/10
  - 读转速时，左摇杆↗读千位，↖读百位，↙读十位，↘读个位。是几蜂鸣器就连续响几声，一直响表示0。
  - 读/写转速时，右摇杆要一直保持在对应的位置，不能松开

- 调整模式
  - 调整模式下滑块为速度环闭环，被外力推动时有一定阻力

- 调整滑块位置
  - 校准滑块零点以后才能调整位置
  - 左摇杆上/下对应滑块上/下

- 校准滑块零点
  - 自动校准
    - ↙↘保持，开始自动校准，滑块会自动下移寻找零点，接触到触点开关后上移一定距离
    - 自动校准开始后可以松开摇杆
    - 底部触点开关被压下时会有蜂鸣器反馈
    - 若滑块下移至最底部还不自动上移，说明触点开关相关线路工作不正常，请立即退出校准模式防止损伤机械结构
  - 手动校准
    - 移动滑块至最底部，此时触点开关被压下，手动转动滑块电机转子端使滑块上移至刚好离开触点开关金属片的位置（不是刚好使触点开关弹起的位置），此时的位置可作为零点
    - 当触点开关损坏时可以手动将滑块移动至零点进行手动校准
    - ↘↙保持，将进行手动校准，以当前位置作为滑块零点
    - **手动校准后必须模拟推弹**，检查滑块停留的位置是否正确
  - 每次上电都需要重新校准
  
- 发射模式
  - 发射模式下滑块为位置环闭环，无法被外力推动
  - 离开发射模式后摩擦轮停止旋转

- 准备发射
  - ↗↖保持，摩擦轮开始旋转
  - 滑块无法移动
  
- 开始发射
  - 校准滑块零点后才能发射
  - 左摇杆每↖一次，滑块往前推一发
  - 打完所有飞镖后再↖一次，滑块回到零点
  - 不开启摩擦轮时滑块也能按上述逻辑运动，可用于模拟推弹

### OLED屏显示内容
- 上电时有彩蛋（doge
- 最外一圈显示四个摩擦轮的实时转速
- 最里一圈显示四个电机的实时温度
- 中间实时温度上方显示摩擦轮设定转速，即`BASE_SPEED + fric_speed_offset`（不包括前后摩擦轮的差速